# Алгоритмическое приложение для торговли акциями

Это минимальный шаблон приложения для торговли акциями с поддержкой симуляции (paper) и интеграции с брокером Alpaca. Включает:
- **Поставщик данных**: Yahoo Finance (для анализа и бэктестинга)
- **Брокеры**: симулятор (paper) и заготовка под Alpaca
- **Стратегия**: простая SMA (цена выше SMA50 — держим позицию, иначе — вне рынка)
- **CLI**: запуск в один клик через Typer

ВНИМАНИЕ: Это демонстрационный проект. Не является инвестиционной рекомендацией. Используйте на свой страх и риск.

## Установка

1. Установите Python 3.10+.
2. Клонируйте/скопируйте проект и перейдите в каталог.
3. Создайте виртуальное окружение и установите зависимости:
```bash
python3 -m venv .venv && source .venv/bin/activate
pip install -r requirements.txt
```

## Настройка

- Для режима симуляции (paper) ключи не требуются.
- Для Alpaca создайте `.env` на основе примера:
```bash
cp .env.example .env
```
И заполните переменные окружения значениями ключей.

Основные переменные:
- `BROKER`: `paper` или `alpaca`
- `ALPACA_KEY_ID`, `ALPACA_SECRET_KEY`
- `ALPACA_BASE_URL`: по умолчанию `https://paper-api.alpaca.markets`
- `STATE_DIR`: каталог для состояния симуляции, по умолчанию `/workspace/state`

## Быстрый старт (симуляция)

Пример запуска с бюджетом 100,000 USD и наблюдаемым списком тикеров:
```bash
python -m app.main run \
  --broker paper \
  --symbols AAPL MSFT NVDA AMZN GOOGL \
  --budget 100000 \
  --warmup 200
```
Это выполнит одно «ребалансирование»: загрузит исторические цены, рассчитает сигналы стратегии SMA и создаст/закроет позиции в симуляторе. Состояние сохраняется в `STATE_DIR`.

## Запуск с Alpaca (бумажная торговля)

1. Убедитесь, что у вас есть ключи Alpaca и включён paper-аккаунт.
2. Заполните `.env` и установите `--broker alpaca`:
```bash
python -m app.main run \
  --broker alpaca \
  --symbols AAPL MSFT NVDA AMZN GOOGL \
  --warmup 200
```
Примечание: Поставщик данных остаётся Yahoo для анализа, ордера отправляются в Alpaca как рыночные.

## Архитектура

- `app/config.py`: конфигурация и переменные окружения
- `app/brokers/`: брокерский слой (`paper`, `alpaca`)
- `app/data/`: поставщики данных (`yahoo`)
- `app/strategy/`: стратегии (`sma_cross`)
- `app/portfolio/portfolio.py`: расчёт целевых весов и ордеров
- `app/main.py`: CLI-скрипт

## Дисклеймер

- Торговля на финансовых рынках связана с риском. Разработчики не несут ответственности за убытки.
- Перед реальным использованием протестируйте стратегию и убедитесь в соответствие требованиям законодательства вашей юрисдикции.
